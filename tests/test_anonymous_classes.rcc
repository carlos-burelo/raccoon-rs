// Test Anonymous Classes - Phase 3 Implementation

// Test 1: Simple anonymous class assignment
fn test_simple_anonymous_class() {
    let Point = class {
        x: int
        y: int

        sum(): int {
            return this.x + this.y
        }
    };

    let p = new Point();
    p.x = 3;
    p.y = 4;
    println(p.sum());  // Should print 7
}

// Test 2: Anonymous class with constructor
fn test_anonymous_class_with_constructor() {
    let Person = class {
        name: str
        age: int

        constructor(n: str, a: int) {
            this.name = n;
            this.age = a;
        }

        describe(): str {
            return this.name + " is " + this.age;
        }
    };

    let alice = new Person("Alice", 30);
    println(alice.describe());  // Should print "Alice is 30"
}

// Test 3: Anonymous class with multiple methods
fn test_anonymous_class_multiple_methods() {
    let Calculator = class {
        add(a: int, b: int): int {
            return a + b;
        }

        multiply(a: int, b: int): int {
            return a * b;
        }

        power(base: int, exp: int): int {
            let result = 1;
            let i = 0;
            while (i < exp) {
                result = result * base;
                i = i + 1;
            }
            return result;
        }
    };

    let calc = new Calculator();
    println(calc.add(5, 3));        // Should print 8
    println(calc.multiply(4, 6));   // Should print 24
    println(calc.power(2, 8));      // Should print 256
}

// Test 4: Anonymous class in variable
fn test_anonymous_class_reusable() {
    let Rectangle = class {
        width: int
        height: int

        area(): int {
            return this.width * this.height;
        }

        perimeter(): int {
            return 2 * (this.width + this.height);
        }
    };

    let rect1 = new Rectangle();
    rect1.width = 5;
    rect1.height = 10;
    println(rect1.area());      // Should print 50
    println(rect1.perimeter()); // Should print 30

    let rect2 = new Rectangle();
    rect2.width = 3;
    rect2.height = 4;
    println(rect2.area());      // Should print 12
    println(rect2.perimeter()); // Should print 14
}

// Test 5: Anonymous class with property initialization
fn test_anonymous_class_property_init() {
    let Config = class {
        debugMode: bool = true
        maxRetries: int = 3
        timeout: int = 5000

        getDebugStatus(): bool {
            return this.debugMode;
        }
    };

    let config = new Config();
    println(config.debugMode);     // Should print true
    println(config.maxRetries);    // Should print 3
    println(config.timeout);       // Should print 5000
    println(config.getDebugStatus()); // Should print true
}

// Test 6: Anonymous class with all features
fn test_anonymous_class_complex() {
    let BankAccount = class {
        accountNumber: str
        balance: int = 0
        accountHolder: str

        constructor(accNum: str, holder: str) {
            this.accountNumber = accNum;
            this.accountHolder = holder;
            this.balance = 0;
        }

        deposit(amount: int): int {
            this.balance = this.balance + amount;
            return this.balance;
        }

        withdraw(amount: int): int {
            if (this.balance >= amount) {
                this.balance = this.balance - amount;
            }
            return this.balance;
        }

        getBalance(): int {
            return this.balance;
        }

        getInfo(): str {
            return this.accountHolder + " - Account: " + this.accountNumber;
        }
    };

    let myAccount = new BankAccount("12345", "John Doe");
    println(myAccount.getInfo());          // Should print "John Doe - Account: 12345"
    println(myAccount.deposit(1000));      // Should print 1000
    println(myAccount.withdraw(300));      // Should print 700
    println(myAccount.getBalance());       // Should print 700
}

// Run all tests
println("=== ANONYMOUS CLASSES TESTS ===");

println("Test 1: Simple anonymous class");
test_simple_anonymous_class();

println("Test 2: Anonymous class with constructor");
test_anonymous_class_with_constructor();

println("Test 3: Anonymous class with multiple methods");
test_anonymous_class_multiple_methods();

println("Test 4: Anonymous class reusable");
test_anonymous_class_reusable();

println("Test 5: Anonymous class with property initialization");
test_anonymous_class_property_init();

println("Test 6: Anonymous class complex");
test_anonymous_class_complex();

println("=== ALL TESTS COMPLETED ===");
