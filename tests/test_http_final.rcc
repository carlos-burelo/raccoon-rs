// Comprehensive HTTP Client Test
import { httpGet, httpPost, httpPut, httpDelete, parseJson } from "std:http"

async fn main(): void {
    print("=== HTTP Client Tests ===")
    print()

    // Test 1: GET request
    print("Test 1: GET request")
    let getRes = await httpGet("https://httpbin.org/get")
    print("Status:", getRes["status"])
    let getData = parseJson(getRes["body"])
    print("URL:", getData["url"])
    print("✓ GET works")
    print()

    // Test 2: POST request with body
    print("Test 2: POST request with JSON body")
    let postRes = await httpPost(
        "https://httpbin.org/post",
        { name: "Carlos", age: 30 }
    )
    print("Status:", postRes["status"])
    print("✓ POST works")
    print()

    // Test 3: POST with body and headers
    print("Test 3: POST with body and headers")
    let postRes2 = await httpPost(
        "https://httpbin.org/post",
        { name: "Carlos" },
        { Authorization: "Bearer my-token" }
    )
    print("Status:", postRes2["status"])
    let postData = parseJson(postRes2["body"])
    let receivedHeaders = postData["headers"]
    print("Authorization header was sent:", receivedHeaders["Authorization"])
    print("✓ POST with headers works")
    print()

    // Test 4: PUT request
    print("Test 4: PUT request")
    let putRes = await httpPut(
        "https://httpbin.org/put",
        { id: 123, name: "Updated" }
    )
    print("Status:", putRes["status"])
    print("✓ PUT works")
    print()

    // Test 5: DELETE request
    print("Test 5: DELETE request")
    let delRes = await httpDelete("https://httpbin.org/delete")
    print("Status:", delRes["status"])
    print("✓ DELETE works")
    print()

    print("=== All tests passed! ===")
}

await main()
