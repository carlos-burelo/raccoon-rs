// Test Pattern Matching - Phase 2 Implementation

// Test 1: Wildcard pattern
fn test_wildcard_pattern() {
    let result = match 42 {
        _ => "matched"
    };
    assert(result == "matched", "Wildcard pattern should match");
}

// Test 2: Variable pattern
fn test_variable_pattern() {
    let value = 10;
    let result = match value {
        x => x * 2
    };
    assert(result == 20, "Variable pattern should bind the value");
}

// Test 3: Multiple arms with different patterns
fn test_multiple_arms() {
    let value = 2;
    let result = match value {
        1 => "one",
        2 => "two",
        _ => "other"
    };
    assert(result == "two", "Should match second arm");
}

// Test 4: List pattern matching
fn test_list_pattern() {
    let list = [1, 2, 3];
    let result = match list {
        [a, b, c] => a + b + c,
        _ => 0
    };
    assert(result == 6, "List pattern should destructure and sum elements");
}

// Test 5: Wildcard in list pattern
fn test_wildcard_list_pattern() {
    let list = [1, 2, 3];
    let result = match list {
        [first, _, third] => first + third,
        _ => 0
    };
    assert(result == 4, "Wildcard in list should skip element");
}

// Test 6: Object pattern matching
fn test_object_pattern() {
    let obj = {x: 10, y: 20};
    let result = match obj {
        {x, y} => x + y,
        _ => 0
    };
    assert(result == 30, "Object pattern should destructure properties");
}

// Test 7: Nested list pattern
fn test_nested_list_pattern() {
    let list = [[1, 2], [3, 4]];
    let result = match list {
        [[a, b], [c, d]] => a + b + c + d,
        _ => 0
    };
    assert(result == 10, "Nested list pattern should work");
}

// Test 8: Match with guard
fn test_match_with_guard() {
    let value = 5;
    let result = match value {
        x if x > 0 => "positive",
        x if x < 0 => "negative",
        _ => "zero"
    };
    assert(result == "positive", "Guard should filter matches");
}

// Test 9: Match order matters
fn test_match_order() {
    let value = 5;
    let result = match value {
        x if x > 3 => "big",
        x if x > 0 => "small",
        _ => "zero"
    };
    assert(result == "big", "First matching arm should be selected");
}

// Test 10: Match returns value
fn test_match_returns_value() {
    let value = 3;
    let result = match value {
        1 => 10,
        2 => 20,
        3 => 30,
        _ => 0
    };
    assert(result == 30, "Match should return the expression value");
}

// Test 11: Object pattern with custom bindings
fn test_object_pattern_binding() {
    let obj = {name: "Alice", age: 30};
    let result = match obj {
        {name: n, age: a} => n,
        _ => ""
    };
    assert(result == "Alice", "Object pattern should bind properties");
}

// Test 12: Fallthrough to default
fn test_default_arm() {
    let value = 99;
    let result = match value {
        1 => "one",
        2 => "two",
        _ => "many"
    };
    assert(result == "many", "Default arm should catch unmatched values");
}

// Test 13: Match with empty list
fn test_empty_list_pattern() {
    let list = [];
    let result = match list {
        [] => "empty",
        _ => "not empty"
    };
    assert(result == "empty", "Empty list pattern should match empty list");
}

// Test 14: Complex nested pattern
fn test_complex_nested() {
    let data = {
        items: [1, 2, 3],
        count: 3
    };
    let result = match data {
        {items: [a, b, c], count: n} => a + b + c + n,
        _ => 0
    };
    assert(result == 9, "Complex nested pattern should work");
}

// Test 15: Multiple guard conditions
fn test_multiple_guards() {
    let x = 5;
    let y = 10;
    let result = match [x, y] {
        [a, b] if a > 0 && b > 0 => "both positive",
        _ => "invalid"
    };
    assert(result == "both positive", "Complex guard should work");
}

// Run all tests
test_wildcard_pattern();
println("Test 1 passed: Wildcard pattern");

test_variable_pattern();
println("Test 2 passed: Variable pattern");

test_multiple_arms();
println("Test 3 passed: Multiple arms");

test_list_pattern();
println("Test 4 passed: List pattern");

test_wildcard_list_pattern();
println("Test 5 passed: Wildcard in list");

test_object_pattern();
println("Test 6 passed: Object pattern");

test_nested_list_pattern();
println("Test 7 passed: Nested list pattern");

test_match_with_guard();
println("Test 8 passed: Match with guard");

test_match_order();
println("Test 9 passed: Match order");

test_match_returns_value();
println("Test 10 passed: Match returns value");

test_object_pattern_binding();
println("Test 11 passed: Object pattern binding");

test_default_arm();
println("Test 12 passed: Default arm");

test_empty_list_pattern();
println("Test 13 passed: Empty list pattern");

test_complex_nested();
println("Test 14 passed: Complex nested");

test_multiple_guards();
println("Test 15 passed: Multiple guards");

println("=== ALL TESTS PASSED ===");
